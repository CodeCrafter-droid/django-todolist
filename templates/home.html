{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TODO LIST - Home</title>

    <!-- Bootstrap -->
     <link rel="icon" type="image/x-icon" href="{% static 'favicon-bl-dk.ico' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <style>
        .form-control{
        padding: 1.375rem .75rem !important;
    }
    </style>
</head>
<body>
<!-- {% if messages %}
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">
    {% for message in messages %}
        <div class="toast show bg-danger text-white">
            <div class="toast-body">
                {{ message }}
            </div>
        </div>
    {% endfor %}
</div>
{% endif %} -->
<nav class="navbar navbar-light bg-light px-3">
  <div class="container-fluid">

    <!-- Left -->
    <div class="col-4 text-start">
      <a class="navbar-brand fw-bold" href="#">TODO</a>
    </div>

    <!-- Center -->
    <div class="col-4 text-center">
      <span class="h3 mb-0">Django ToDo App</span>
    </div>
<div class="col-4 text-end">
        <span class="d-block d-md-inline me-md-2 mb-1 mb-md-0 fw-semibold">
            Hello, {{ request.user.username }}
        </span>
    <form method="post" action="{% url 'logout' %}" class="d-block d-md-inline me-1 mb-1 mb-md-0">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">
            Log out
        </button>
    </form>
        <form method="post" action="{% url 'deleteacc' %}" class="d-block d-md-inline">
        {% csrf_token %}
            <button  type="button"  class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
              Delete Account
            </button>
        </form>
</div>
</nav>    
<div class="container">
        <div class="row">
            <h4>My Day</h4>
            <p class="text-muted">{% now "jS F Y" %}</p>
            <div class="col-md-7 col-lg-7" style="height: 450px; overflow: scroll;">
                <!-- List of all the tasks for the day -->
                {% for task in td %}
                {% if task.is_completed == False %}
                <div class="card m-1">
                    <div class="card-body">
                        {{ task.task }}
                        <span style="position: relative; float: right;">
                            <form action="{% url 'mark_done' task.id %}" style="display:inline;">
                                <button type="submit" class="btn btn-success btn-sm">
                                        <i class="fa fa-check"></i> Mark as Done
                                </button>
                            </form>
                            <form action="{% url 'delete_task' task.id %}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this task?');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger btn-sm">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </form>
                            <form action="{% url 'edit_task' task.id %}" method="get" style="display:inline;">
                                <button type="submit" class="btn btn-primary btn-sm">
                                    <i class="fa fa-pencil"></i>
                                </button>
                           </form>
                        </span>
                    </div>
                </div>
               {% endif %}
               {% endfor %}
            </div>
            <div class="col-md-5 col-lg-5" style="height: 450px; overflow: scroll;">
                <h5>Completed Tasks</h5>
                <!-- List of all the tasks that have completed -->
                {% for task in td %}
                {% if task.is_completed  %}
                <div class="card m-1">
                    <div class="card-body">
                        {{task.task}}
                        <span style="position: relative; float: right;">
                          <form action="{% url 'undo_task' task.id %}" style="display:inline;">
                                <button type="submit" class="btn btn-warning btn-sm">
                                    <i class="fa fa-undo"></i> Undo
                                </button>
                          </form>
                            <form action="{% url 'delete_task' task.id %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger btn-sm">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </form>
                        </span>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 col-lg-6 p-0 mt-2">
                <!-- To Do Form -->
                <form action="{% url 'addtask' %}" method="post" class="mx-auto px-2" style="max-width: 500px;">
                    {% csrf_token %}
                    <div class="row g-2">
                        <div class="col-12 col-md-8">
                            <input type="text" class="form-control" placeholder="Add a task" name="data" required>
                        </div>
                        <div class="col-12 col-md-4">
                            <button type="submit" class="btn btn-primary w-100 h-100">
                                <i class="fa fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <div class="modal-header bg-danger text-white">
                  <h5 class="modal-title">âš  Delete Account</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <form method="post" action="{% url 'deleteacc' %}">
                      {% csrf_token %}              
                    <div class="modal-body">
                        {% if messages %}
                        {% for message in messages %}
                          <div class="alert alert-danger py-2">
                            {{ message }}
                          </div>
                        {% endfor %}
                        {% endif %}
                            <p class="fw-bold text-danger">
                              This action is permanent and cannot be undone.
                            </p>
                            <p>Please enter your password to confirm:</p>
                        <div class="position-relative">
                            <input  type="password" id="loginPassword" name="password" class="form-control pe-5" placeholder="Enter your password" required>
                            <span  class="position-absolute top-50 end-0 translate-middle-y me-3" style="cursor: pointer;" onclick="togglePassword('loginPassword', this)">
                                <i class="fa fa-eye"></i>
                            </span>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                              Cancel
                            </button>
                  
                            <button type="submit" class="btn btn-danger">
                              Yes, Delete My Account
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>
<script>
  function togglePassword(inputId, iconSpan) {
    const input = document.getElementById(inputId);
    const icon = iconSpan.querySelector("i");

    if (input.type === "password") {
      input.type = "text";
      icon.classList.remove("fa-eye");
      icon.classList.add("fa-eye-slash");
    } else {
      input.type = "password";
      icon.classList.remove("fa-eye-slash");
      icon.classList.add("fa-eye");
    }
  }
</script>
{% if messages %}
<script>
  const deleteModal = new bootstrap.Modal(
    document.getElementById('deleteAccountModal')
  );
  deleteModal.show();
</script>
{% endif %}
</body>
</html>